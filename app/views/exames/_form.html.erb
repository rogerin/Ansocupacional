<%= form_for(@exame, :multipart => true, :html => {:class => "form-horizontal"}) do |f| %>
  <% if @exame.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@exame.errors.count, "error") %> para corrigir:</h2>

      <ul>
      <% @exame.errors.full_messages.each do |msg| %>
        <li class="text-danger"><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>



    <div class="form-group">
      <label class="col-lg-2 control-label">Empresa</label>
      <div class="col-lg-4">
        <%= f.collection_select :empresa_id, @empresas, :id, :nome, {:prompt => 'Empresa'}, {:id => 'exame_empresa_id', :class=>'form-control', :allow_blank => true } %>
      </div>
    </div>

    <div class="form-group">
      <label class="col-lg-2 control-label">Funcionário</label>
      <div class="col-lg-4">
        <%= f.collection_select :funcionario_id, @funcionarios, :id, :nome, {:prompt => 'Selecione a empresa'}, {:class=>'funcionarios form-control', :allow_blank => true } %>
      </div>
    </div>

    <tr>
        <td class="col-lg-2"></td>
        <td class="col-lg-4">
          <%= f.file_field :link, class: 'form-control' %> <br />
          <%= f.collection_select(:categoria_id, @categorias, :id, :nome, {:prompt => 'Selecione a categoria'}, {:class=>'form-control' } )  %>
        </td>
        <td class="col-lg-6"></td>
      </tr>


   <%= f.file_field :pdf %> <br />
<!--
  <table class="table table-striped">
  <thead>
    <tr>
      <th class="col-lg-2"></th>
      <th>Exames  <small>( <a href="#" id="enviar_outro">enviar outro</a> )</small></th>
      <th></th>
    <tr>
  </thead>
  <tbody>
      <tr>
        <td class="col-lg-2"></td>
        <td class="col-lg-4">
          <%= f.file_field :pdf %> <br />
         
        </td>
        <td class="col-lg-6"></td>
      </tr><tr>
        <td class="col-lg-2"></td>
        <td class="col-lg-4">
          <%= f.file_field :link, class: 'form-control' %> <br />
          <%= collection_select(:exame, :categoria_id, @categorias, :id, :nome, {:prompt => 'Selecione a categoria'}, {:class=>'form-control' } )  %>
        </td>
        <td class="col-lg-6"></td>
      </tr>
<!--
      <tr>
        <td class="col-lg-2"></td>
        <td class="col-lg-4">
          <%= f.file_field :link, class: 'form-control', :multiple => true, :name => 'exames[link][]'  %> <br />
          <%= collection_select(:exame, :categoria_id, @categorias, :id, :nome, {:prompt => 'Selecione a categoria'}, {:class=>'form-control', :name => 'exame[categoria_ids][]'} )  %>
        </td>
        <td class="col-lg-6"></td>
      </tr>

      <tr>
        <td class="col-lg-2"></td>
        <td class="col-lg-4">
          <%= f.file_field :link, class: 'form-control', :multiple => true, :name => 'exames[link][]'  %> <br />
          <%= collection_select(:exame, :categoria_id, @categorias, :id, :nome, {:prompt => 'Selecione a categoria'}, {:class=>'form-control', :name => 'exame[categoria_ids][]'} )  %>
        </td>
        <td class="col-lg-6"></td>
      </tr>

      <tr>
        <td class="col-lg-2"></td>
        <td class="col-lg-4">
          <%= f.file_field :link, class: 'form-control', :multiple => true, :name => 'exames[link][]'  %> <br />
          <%= collection_select(:exame, :categoria_id, @categorias, :id, :nome, {:prompt => 'Selecione a categoria'}, {:class=>'form-control', :name => 'exame[categoria_ids][]'} )  %>
        </td>
        <td class="col-lg-6"></td>
      </tr>

      <tr>
        <td class="col-lg-2"></td>
        <td class="col-lg-4">
          <%= f.file_field :link, class: 'form-control', :multiple => true, :name => 'exames[link][]'  %> <br />
          <%= collection_select(:exame, :categoria_id, @categorias, :id, :nome, {:prompt => 'Selecione a categoria'}, {:class=>'form-control', :name => 'exame[categoria_ids][]'} )  %>
        </td>
        <td class="col-lg-6"></td>
      </tr>

      <tr>
        <td class="col-lg-2"></td>
        <td class="col-lg-4">
          <%= f.file_field :link, class: 'form-control', :multiple => true, :name => 'exames[link][]'  %> <br />
          <%= collection_select(:exame, :categoria_id, @categorias, :id, :nome, {:prompt => 'Selecione a categoria'}, {:class=>'form-control', :name => 'exame[categoria_ids][]'} )  %>
        </td>
        <td class="col-lg-6"></td>
      </tr>
-->
  </tbody>
  </table>

  <div class="form-group">
    <div class="col-lg-offset-2 col-lg-2">
      <%= f.submit 'Salvar', class: 'btn btn-success' %>
    </div>
  </div>


<% end %>
<script type="text/javascript">

$('#enviar_outro').click(function(){
  console.log("outro");
  return false;
})


$("#exame_empresa_id").change(function(){
    var empresa_id = $(this).val();
    //console.log(empresa_id);
    $.ajax({ 
      url: "<%= javascripts_funcionarios_dinamicos_path %>",
      type: "POST", 
      data: { 'empresa_id': empresa_id},
      beforeSend: function(){
       $('.funcionarios').html("<option>Carregando Funcionários....</option>"); 
      },
      success: function(data)   //here is object
      {
        $('.funcionarios').empty();
        var result = JSON.parse(data);
        $.each(result , function(k, item) { 
          $('.funcionarios')
            .append($("<option></option>")
            .attr("value", item.id)
            .text(item.nome));
        });
      },
      error: function(){
        alert("Ocorreu um ERRO no carregamento do AJAX, entre em contato com o desenvolvedor.");
      },
      dataType : "html"
    });      
  });

</script>
